name: Notify Slack on PR

on:
  pull_request:
    types: [opened, reopened, synchronize]

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: Slack notification
        env:
          SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
          SLACK_CHANNEL: ${{ secrets.SLACK_PR_CHANNEL_ID }}
          PR_TITLE: ${{ github.event.pull_request.title }}
          PR_URL: ${{ github.event.pull_request.html_url }}
          PR_USER: ${{ github.event.pull_request.user.login }}
          REPO_NAME: ${{ github.repository }}
        run: |
          curl -X POST -H "Authorization: Bearer $SLACK_BOT_TOKEN" -H 'Content-type: application/json' --data '{
            "channel": "$SLACK_CHANNEL",
            "text": "*Pull Request Alert* :tada:",
            "attachments": [
              {
                "color": "#36a64f",
                "title": "PR: $PR_TITLE",
                "title_link": "$PR_URL",
                "text": "A new pull request has been created or updated in *$REPO_NAME* by *$PR_USER*.",
                "fields": [
                  {
                    "title": "Repository",
                    "value": "$REPO_NAME",
                    "short": true
                  },
                  {
                    "title": "Author",
                    "value": "$PR_USER",
                    "short": true
                  }
                ]
              }
            ]
          }' https://slack.com/api/chat.postMessage
